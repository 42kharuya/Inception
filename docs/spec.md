# Inception
**概要:** このドキュメントはシステム管理に関連する演習です。
**バージョン:** 5.2



## 目次
I. 前書き (Preamble) - 2
II. はじめに (Introduction) - 3
III. 一般的なガイドライン (General guidelines) - 4
IV. AIに関する指示 (AI Instructions) - 5
V. 必須パート (Mandatory part) - 7
VI. Readmeの要件 (Readme Requirements) - 12
VII. 検証のための前提条件 (Prerequisites for validation) - 14
VIII. ボーナスパート (Bonus part) - 15
IX. 提出とピア評価 (Submission and peer-evaluation) - 16



## 第1章：前書き
**コンテナ一つでは足りない。**
**もっと深く潜る必要がある。**



## 第2章：はじめに
このプロジェクトは、Dockerを使用してシステム管理の知識を深めることを目的としています。
新しい個人の仮想マシン（VM）内に、いくつかのDockerイメージを仮想化して作成します。



## 第3章：一般的なガイドライン
* このプロジェクトは仮想マシン（VM）上で行う必要があります。
* プロジェクトの構成に必要なすべてのファイルは、`srcs` フォルダに配置する必要があります。
* `Makefile` も必須であり、ディレクトリのルートに配置する必要があります。
* Makefileは、アプリケーション全体をセットアップする必要があります（つまり、`docker-compose.yml` を使用してDockerイメージをビルドする必要があります）。
* この課題は、あなたの経歴によってはまだ学んでいない概念の実践を必要とします。
* したがって、Dockerの使用方法に関するドキュメントや、この課題を完了するために役立つと思われるその他の資料をたくさん読むことをお勧めします。



## 第4章：AIに関する指示
### コンテキスト
学習の過程で、AIはさまざまなタスクをサポートしてくれます。AIツールのさまざまな機能や、それらがどのように作業をサポートできるかを探求する時間を取ってください。
ただし、常に注意深く取り組み、結果を批判的に評価してください。コード、ドキュメント、アイデア、技術的な説明など、質問が適切に構成されていたか、生成されたコンテンツが正確であるかを完全に確信することはできません。
あなたの仲間（ピア）は、間違いや盲点を避けるための貴重なリソースです。

### メインメッセージ
* 単純作業や退屈なタスクを減らすためにAIを使用してください。
* 将来のキャリアに役立つ、コーディングおよび非コーディングの両方のプロンプトスキルを身につけてください。
* AIシステムがどのように機能するかを学び、一般的なリスク、偏見、倫理的問題をより適切に予測し、回避してください。
* 仲間と協力することで、技術的スキルとパワースキル（ソフトスキル）の両方を構築し続けてください。
* 自分が完全に理解し、責任を持てるAI生成コンテンツのみを使用してください。

### 学習者のルール
* AIツールを倫理的に使用し、潜在的な偏見を減らすために、AIツールがどのように機能するかを理解し、探求する時間を取るべきです。
* プロンプトを出す前に問題について熟考すべきです。これにより、正確な用語を使用して、より明確で詳細かつ関連性の高いプロンプトを書くことができます。
* AIによって生成されたものは、体系的にチェック、レビュー、疑問視、テストする習慣を身につけるべきです。
* 常にピアレビューを求めるべきです。自分自身の検証だけに頼らないでください。



## AIに関する指示（続き）
### フェーズの成果：
* 汎用およびドメイン固有の両方のプロンプトスキルを開発する。
* AIツールの効果的な使用により生産性を向上させる。
* コンピューテーショナルシンキング、問題解決能力、適応性、コラボレーションを強化し続ける。

### コメントと例：
* 試験や評価など、本当の理解を証明しなければならない状況に定期的に直面します。準備を整え、技術的スキルと対人スキルの両方を構築し続けてください。
* 自分の推論を説明し、仲間と議論することで、理解のギャップが明らかになることがよくあります。ピアラーニングを優先してください。
* AIツールは特定のコンテキストを欠いていることが多く、一般的な回答を提供する傾向があります。環境を共有している仲間は、より適切で正確な洞察を提供できます。
* AIが「最もありそうな答え」を生成する傾向があるのに対し、仲間は代替の視点や貴重なニュアンスを提供できます。品質チェックポイントとして彼らを頼りにしてください。

✅ **良い例：**
AIに「ソート機能のテスト方法」を尋ね、いくつかのアイデアを得る。それらを試してみて、仲間と一緒に結果を確認する。一緒にアプローチを洗練させる。

❌ **悪い例：**
AIにコード全体を書かせ、それをプロジェクトにコピー＆ペーストする。ピア評価中に、そのコードが何をしているのか、なぜそうなるのかを説明できない。信頼を失い、プロジェクトに不合格となる。

✅ **良い例：**
AIを使用してパーサーの設計を支援し、その後、仲間と一緒にロジックを確認する。2つのバグを見つけ、一緒に書き直すことで、より良く、よりクリーンで、完全に理解されたものになる。

❌ **悪い例：**
Copilotにプロジェクトの主要部分のコードを生成させる。コンパイルは通るが、パイプの処理方法を説明できない。評価中に正当性を証明できず、不合格となる。



## 第5章：必須パート
このプロジェクトでは、特定のルールの下で、さまざまなサービスで構成される小さなインフラストラクチャをセットアップします。
プロジェクト全体を仮想マシン上で行う必要があり、`docker compose` を使用しなければなりません。

* 各Dockerイメージは、対応するサービスと同じ名前にする必要があります。
* 各サービスは専用のコンテナで実行する必要があります。
* パフォーマンス上の理由から、コンテナは Alpine または Debian の最後から2番目の安定バージョンからビルドする必要があります。選択は自由です。
* 各サービスにつき1つの `Dockerfile` を自分で作成する必要があります。
* `Dockerfile` は、`Makefile` を介して `docker-compose.yml` 内で呼び出される必要があります。
* つまり、プロジェクトのDockerイメージを自分でビルドする必要があります。既製のイメージをプルすることや、DockerHubなどのサービスを使用することは禁止されています（Alpine/Debian自体はこのルールの対象外です）。

### セットアップが必要なもの：
* **NGINX:** TLSv1.2 または TLSv1.3 のみを使用するコンテナ。
* **WordPress + php-fpm:** （インストールおよび構成済みであること）のみを含むコンテナ。NGINXは含めない。
* **MariaDB:** のみを含むコンテナ。NGINXは含めない。
* **ボリューム 1:** WordPressのデータベースを保持。
* **ボリューム 2:** WordPressのウェブサイトファイルを保持。
* これら2つの永続ストレージには、**Dockerの名前付きボリューム（named volumes）**を使用する必要があります。バインドマウントは許可されません。
* 両方のボリュームは、ホストマシンの `/home/login/data` 内にデータを保存する必要があります（`login` は自分のユーザー名に置き換えてください）。
* **docker-network:** コンテナ間の接続を確立。
* コンテナはクラッシュした場合に再起動するように設定する必要があります。



## 必須パート（続き）
* Dockerコンテナは仮想マシンではありません。したがって、実行時に `tail -f` や同様の方法に基づいたハッキング的なパッチを使用することはお勧めしません。デーモンがどのように機能するか、それらを使用するのが良いアイデアかどうかを読んでください。
* もちろん、`network: host` や `--link`、`links:` の使用は禁止されています。`network` 行が `docker-compose.yml` ファイルに含まれている必要があります。
* コンテナは、無限ループを実行するコマンドで開始してはいけません。これは、エントリポイントとして使用されるコマンドや、エントリポイントスクリプトで使用されるコマンドにも適用されます。以下のハッキング的パッチは禁止されています：`tail -f`、`bash`、`sleep infinity`、`while true`。
* PID 1 と Dockerfile作成のベストプラクティスについて読んでください。
* WordPressデータベースには、2人のユーザーが必要です。そのうちの1人は**管理者**である必要があります。管理者のユーザー名に `admin` / `Admin` や `administrator` / `Administrator` を含めることはできません。
* ボリュームは、Dockerを使用してホストマシンの `/home/login/data` フォルダで利用可能になります（`login` は自分のものに置き換えてください）。
* 設定を簡単にするために、ドメイン名がローカルIPアドレスを指すように設定してください。このドメイン名は `login.42.fr` にする必要があります。
* `latest` タグの使用は禁止されています。
* `Dockerfile` 内にパスワードを記述してはいけません。
* **環境変数**の使用は必須です。また、環境変数を保存するために `.env` ファイルを使用することも必須です。機密情報を保存するには、**Docker secrets**を使用することを強く推奨します。
* Gitリポジトリ内に見つかった資格情報、APIキー、パスワード（適切に構成されたシークレット以外）は、プロジェクトの不合格につながります。
* NGINXコンテナは、ポート 443 のみを介して、TLSv1.2 または TLSv1.3 プロトコルを使用する、インフラストラクチャへの唯一のエントリポイントである必要があります。



## 期待される結果の図（例）
* **Computer HOST** (ホストコンピュータ)
  * **Docker network** (Dockerネットワーク)
    * **WWW (443)** -> **Container NGINX**
    * **Container NGINX** <-> **Container WordPress+PHP (9000)**
    * **Container WordPress+PHP** <-> **Container DB (3306)**
  * **Volumes**
    * WordPressファイル用のボリューム
    * データベース用のボリューム



## 期待されるディレクトリ構造の例
```bash
$> ls -alR
total XX
drwxrwxr-x 3 wil wil 4096 avril 42 20:42 .
drwxrwxrwt 17 wil wil 4096 avril 42 20:42 ..
-rw-rw-r-- 1 wil wil XXXX avril 42 20:42 Makefile # ルートのMakefile [cite: 143]
drwxrwxr-x 3 wil wil 4096 avril 42 20:42 secrets # シークレット用ディレクトリ [cite: 143]
drwxrwxr-x 3 wil wil 4096 avril 42 20:42 srcs # ソース用ディレクトリ [cite: 143]

./secrets:
total XX
drwxrwxr-x 2 wil wil 4096 avril 42 20:42 .
drwxrwxr-x 6 wil wil 4096 avril 42 20:42 ..
-rw-r--r-- 1 wil wil XXXX avril 42 20:42 credentials.txt # 資格情報 [cite: 144]
-rw-r--r-- 1 wil wil XXXX avril 42 20:42 db_password.txt # DBパスワード [cite: 144]
-rw-r--r-- 1 wil wil XXXX avril 42 20:42 db_root_password.txt # DBルートパスワード [cite: 144]

./srcs:
total XX
drwxrwxr-x 3 wil wil 4096 avril 42 20:42 .
drwxrwxr-x 3 wil wil 4096 avril 42 20:42 ..
-rw-rw-r-- 1 wil wil XXXX avril 42 20:42 docker-compose.yml # Composeファイル [cite: 145]
-rw-rw-r-- 1 wil wil XXXX avril 42 20:42 .env # 環境変数ファイル [cite: 145]
drwxrwxr-x 5 wil wil 4096 avril 42 20:42 requirements # 各サービスの設定 [cite: 145]

./srcs/requirements:
total XX
drwxrwxr-x 5 wil wil 4096 avril 42 20:42 .
drwxrwxr-x 3 wil wil 4096 avril 42 20:42 ..
drwxrwxr-x 4 wil wil 4096 avril 42 20:42 bonus # ボーナスパーツ用 [cite: 146]
drwxrwxr-x 4 wil wil 4096 avril 42 20:42 mariadb # MariaDB用 [cite: 146]
drwxrwxr-x 4 wil wil 4096 avril 42 20:42 nginx # NGINX用 [cite: 146]
drwxrwxr-x 4 wil wil 4096 avril 42 20:42 tools # ツール類 [cite: 146]
drwxrwxr-x 4 wil wil 4096 avril 42 20:42 wordpress # WordPress用 [cite: 146]

./srcs/requirements/mariadb:
total XX
drwxrwxr-x 4 wil wil 4096 avril 42 20:45 .
drwxrwxr-x 5 wil wil 4096 avril 42 20:42 ..
drwxrwxr-x 2 wil wil 4096 avril 42 20:42 conf # 設定ファイル [cite: 147]
-rw-rw-r-- 1 wil wil XXXX avril 42 20:42 Dockerfile # 専用Dockerfile [cite: 147]
-rw-rw-r-- 1 wil wil XXXX avril 42 20:42 .dockerignore
drwxrwxr-x 2 wil wil 4096 avril 42 20:42 tools # スクリプト等 [cite: 147]

./srcs/requirements/nginx:
total XX
drwxrwxr-x 4 wil wil 4096 avril 42 20:42 .
drwxrwxr-x 5 wil wil 4096 avril 42 20:42 ..
drwxrwxr-x 2 wil wil 4096 avril 42 20:42 conf # 設定ファイル [cite: 148]
-rw-rw-r-- 1 wil wil XXXX avril 42 20:42 Dockerfile # 専用Dockerfile [cite: 148]
-rw-rw-r-- 1 wil wil XXXX avril 42 20:42 .dockerignore
drwxrwxr-x 2 wil wil 4096 avril 42 20:42 tools

$> cat srcs/.env
DOMAIN_NAME=wil.42.fr # ドメイン名の例 [cite: 148]
MYSQL_USER=XXXXXXXXXXXX # MySQLユーザーの例 [cite: 148]
```

* セキュリティ上の理由から、資格情報やパスワードなどはローカルに保存し、gitでは無視（ignore）する必要があります。公開された資格情報は即座に不合格となります。



## 第6章：Readmeの要件
リポジトリのルートに `README.md` ファイルを提供する必要があります。その目的は、プロジェクトに詳しくない人が、プロジェクトの内容、実行方法、詳細情報の入手先をすばやく理解できるようにすることです。

### README.md に含めるべき内容：
* 最初の行は斜体で次のように記述する：*This project has been created as part of the 42 curriculum by <login1>[, <login2>[, <login3>[...]]].*
* **Description（説明）:** プロジェクトの目的と概要を明確に提示。
* **Instructions（指示）:** コンパイル、インストール、実行に関する関連情報。
* **Resources（リソース）:** 関連する参考文献（ドキュメント、記事、チュートリアル等）と、AIがどのように使用されたかの説明（どのタスクとどの部分に使用したか）。
* **プロジェクト説明セクション:** Dockerの使用とプロジェクトに含まれるソースについて説明。また、以下の比較を含めること：
  * Virtual Machines vs Docker
  * Secrets vs Environment Variables
  * Docker Network vs Host Network
  * Docker Volumes vs Bind Mounts
* READMEは**英語**で記述する必要があります。



## 第7章：検証のための前提条件
リポジトリのルートに以下のドキュメントファイル（Markdown形式）が必要です。

* **USER_DOC.md（ユーザー向けドキュメント）:** * スタックによって提供されるサービスの理解。
  * プロジェクトの開始と停止方法。
  * ウェブサイトと管理パネルへのアクセス方法。
  * 資格情報の場所と管理方法。
  * サービスが正しく実行されているかの確認方法。
* **DEV_DOC.md（開発者向けドキュメント）:**
  * 環境をゼロからセットアップする方法（前提条件、構成ファイル、シークレット）。
  * MakefileとDocker Composeを使用したビルドと起動方法。
  * コンテナとボリュームを管理するための関連コマンド。
  * プロジェクトデータがどこに保存され、どのように永続化されるかの特定。



## 第8章：ボーナスパート
ボーナスパートはシンプルにすることを目的としています。各追加サービスに対して `Dockerfile` を作成する必要があります。

### ボーナスリスト：
* WordPressウェブサイト用の **Redis cache**。
* WordPressウェブサイトのボリュームを指す **FTPサーバー**。
* PHP以外の言語で作成された**シンプルな静的ウェブサイト**（履歴書サイトなど）。
* **Adminer** のセットアップ。
* 自分が有用だと思う**任意のサービス**（評価時に理由を説明する必要があります）。

* ボーナスパートを完了するために、必要に応じてより多くのポートを開放することができます。
* **重要:** ボーナスパートは、必須パートが完全に（完璧に）完了している場合にのみ評価されます。



## 第9章：提出とピア評価
* 通常通りGitリポジトリに提出してください。
* 評価（ディフェンス）中に、プロジェクトの簡単な修正を求められることがあります（動作の変更、数行のコードの書き換え、機能の追加など）。
* これは、プロジェクトの特定の部分に対するあなたの実際の理解を確認するためのものです。数分以内で実行できるはずです。